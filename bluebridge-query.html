<!--
`bluebridge-query`
Fetches an array of document ids from the BlueBridge instance
-->
<dom-module id="bluebridge-query">
  <template>
  </template>

  <script>
    Polymer({

      is: 'bluebridge-query',

      properties: {
        collection: {
          type: String,
          observer: '_collectionChanged',
        },
        query: {
          type: Object,
          observer: '_queryChanged',
          notify: true,
        },
        results: {
          type: Array,
          observer: '_resultsChanged',
          notify: true,
          value: [],
        },
        loading: {
          type: Boolean,
        },
      },

      _collectionChanged: function (collection) {
        this.reload();
      },

      _queryChanged: function (query) {
        this.reload();
      },

      _idsChanged: function (ids) {
        // console.log(ids);
      },

      _resultsChanged: function (results) {
        // console.log(results);
      },

      reload: function () {
        if (!this.collection) {
          return;
        }
        this.loading = true;
        this.loaded = false;
        window.bluebridge
          .query(this.collection, this.query)
          .then(results => {
            this.results = results;
            this.loading = false;
            this.loaded = true;
          });
      },

    });
  </script>
</dom-module>
